<?xml version="1.0" encoding="UTF-8" ?>
<OpenSimDocument Version="40000">
    <MuscleTendonPersonalizationTool>
        <!--MTP AND NCP SHARED SETTINGS-->
        <!--Directory used for writing results.-->
        <results_directory>results</results_directory>
        <!--Name of the input model file (.osim) to use-->
        <input_model_file>optModel_MuscleGroups_LeftMusclesActive_NewSynx.osim</input_model_file>
        <!--Directory for data files-->
        <data_directory></data_directory>
		<!--Coordinates Muscle-Tendon Personalization tracked their joint moments. Leave empty for none. Muscles spanning these coordinates will be extracted automatically.-->
		<coordinate_list>hip_flexion_l hip_adduction_l hip_rotation_l knee_angle_l ankle_angle_l subtalar_angle_l</coordinate_list>
        <!--*Optional* The vMaxFactor to use-->
        <v_max_factor>10</v_max_factor>
        <!--A space-separated list of the activation muscle groups. -->
        <activation_muscle_groups> AdductorActivationGroupL GluteusMaxActivationGroupL GluteusMedActivationGroupL GluteusMinActivationGroupL IliopsoasActivationGroupL HamstringActivationGroupL BicepsFemActivationGroupL PeroneusActivationGroupL</activation_muscle_groups>
        <!--A space-separated list of the normalized fiber length muscle groups. -->
        <normalized_fiber_length_muscle_groups> AdductorFiberLengthGroupL GluteusMaxFiberLengthGroupL GluteusMedFiberLengthGroupL GluteusMinFiberLengthGroupL QuadricepFiberLengthGroupL HamstringFiberLengthGroupL PeroneusFiberLengthGroupL IliopsoasFiberLengthGroupL GastrocFiberLengthGroupL TibialisAnteriorFiberLengthGroupL TibialisPosteriorFiberLengthGroupL</normalized_fiber_length_muscle_groups>
		<!--*Optional* space-separated list of prefixes to use for data files, if left blank, use all prefixes fron IK folder-->
		<trial_prefixes></trial_prefixes>
        <!--*Optional* The number of allowed iterations of the fmincon optimization, setting this lower can help cancel an optimization that won't converge-->
        <max_iterations>2e3</max_iterations>
        <!--*Optional* The number of allowed cost function calls for the fmincon optimization, setting this lower can help cancel an optimization that won't converge-->
        <max_function_evaluations>1e8</max_function_evaluations>
		<MuscleTendonLengthInitialization>
			<!--Boolean (true, false) indicating if muscle tendon length initialization should be performed before muscle tendon personalization-->
			<is_enabled>true</is_enabled>
			<passive_data_input_directory>thelen</passive_data_input_directory>
			<max_normalized_muscle_fiber_length>1</max_normalized_muscle_fiber_length>
			<min_normalized_muscle_fiber_length>0.6</min_normalized_muscle_fiber_length>
            <optimize_maximum_muscle_stress>true</optimize_maximum_muscle_stress>
            <optimize_isometric_max_force>true</optimize_isometric_max_force>
            <!--*Optional* The muscle specific tension to use-->
            <maximum_muscle_stress>610e3</maximum_muscle_stress>
			<MuscleTendonLengthInitializationCostFunctionTerms>
				<IndividualMuscles>
					<PassiveJointMoments>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>2</max_allowable_error>
					</PassiveJointMoments>
					<OptimalMuscleFiberLength>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>0.3</max_allowable_error>
						<!--Reference value relative to which errors are calculated-->
						<error_center>1</error_center>
					</OptimalMuscleFiberLength>
					<TendonSlackLength>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>1</max_allowable_error>
						<!--Reference value relative to which errors are calculated-->
						<error_center>1</error_center>
					</TendonSlackLength>
					<MinimumNormalizedMuscleFiberLength>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>0.3</max_allowable_error>
					</MinimumNormalizedMuscleFiberLength>
					<MaximumNormalizedMuscleFiberLength>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>0.03</max_allowable_error>
					</MaximumNormalizedMuscleFiberLength>
					<MaximumMuscleStress>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>0.1</max_allowable_error>
						<!--Reference value relative to which errors are calculated-->
						<error_center>1.2</error_center>
					</MaximumMuscleStress>
					<PassiveMuscleForces>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>10</max_allowable_error>
					</PassiveMuscleForces>
				</IndividualMuscles>
				<GroupedMuscles>
					<NormalizedMuscleFiberLength>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>0.1</max_allowable_error>
					</NormalizedMuscleFiberLength>
					<MaximumNormalizedMuscleFiberLength>
						<!--Flag indicating whether or not the term is enabled in the cost function.-->
						<is_enabled>true</is_enabled>
						<!--Max allowable error or deviation from indicated set point-->
						<max_allowable_error>0.1</max_allowable_error>
					</MaximumNormalizedMuscleFiberLength>
				</GroupedMuscles>
			</MuscleTendonLengthInitializationCostFunctionTerms>
		</MuscleTendonLengthInitialization>
        <!-- END OF MTP AND NCP SHARED SETTINGS-->
        <!--MTP SPECIFIC SETTINGS-->
        <!--A space-separated list of missing EMG channel names.-->
        <missing_emg_channel_muscle_groups> AddLongMissingEmgChannelL ExtDigLongMissingEmgChannelL FlexDigLongMissingEmgChannelL IliopsoasMissingEmgChannelL PeroneusLongMissingEmgChannelL RecFemMissingEmgChannelL TibPostMissingEmgChannelL VastMedMissingEmgChannelL</missing_emg_channel_muscle_groups>
        <!--A space-separated list of collected EMG channel names.-->
        <collected_emg_channel_muscle_groups> BicFemLongCollectedEmgChannelL GasMedCollectedEmgChannelL GlutMaxCollectedEmgChannelL GlutMedCollectedEmgChannelL SemiMembCollectedEmgChannelL SolCollectedEmgChannelL TibAntCollectedEmgChannelL VastLatCollectedEmgChannelL</collected_emg_channel_muscle_groups>
		<MuscleTendonPersonalizationTaskList>
			<MuscleTendonPersonalizationTask>
				<!--Flag indicating whether or not the task is enabled.-->
				<is_enabled>true</is_enabled>
				<!--Index indicates the order of the tasks. The task with the smallest index is completed first.-->
				<index>4</index>
				<!--Boolean (true, false) indicating if electromechanical delays should be optimized for this task-->
				<optimize_electromechanical_delays>true</optimize_electromechanical_delays>
				<!--Boolean (true, false) indicating if activation time constants should be optimized for this task-->
				<optimize_activation_time_constants>true</optimize_activation_time_constants>
				<!--Boolean (true, false) indicating if activation nonlinearity constants should be optimized for this task-->
				<optimize_activation_nonlinearity_constants>true</optimize_activation_nonlinearity_constants>
				<!--Boolean (true, false) indicating if EMG scale factors should be optimized for this task-->
				<optimize_emg_scale_factors>true</optimize_emg_scale_factors>
				<!--Boolean (true, false) indicating if electromechanical delays should be optimized for this task-->
				<optimize_optimal_fiber_lengths>true</optimize_optimal_fiber_lengths>
				<!--Boolean (true, false) indicating if electromechanical delays should be optimized for this task-->
				<optimize_tendon_slack_lengths>true</optimize_tendon_slack_lengths>
				<!--Boolean (true, false) indicating if synergy extrapolation should be performed during this task-->
				<perform_synergy_extrapolation>true</perform_synergy_extrapolation>
			</MuscleTendonPersonalizationTask>
		</MuscleTendonPersonalizationTaskList>
        <MuscleTendonCostFunctionTerms>
            <IndividualMuscles>
                <!--*Optional* Inverse dynamic joint moments -->
                <InverseDynamicJointMoments>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>2</max_allowable_error>
                </InverseDynamicJointMoments>
                <ActivationTimeConstant>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.02</max_allowable_error>
                    <!--Reference value relative to which errors are calculated-->
                    <error_center>0.015</error_center>
                </ActivationTimeConstant>
                <ActivationNonlinearityConstant>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.1</max_allowable_error>
                </ActivationNonlinearityConstant>
                <OptimalMuscleFiberLength>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.1</max_allowable_error>
                </OptimalMuscleFiberLength>
                <TendonSlackLength>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.1</max_allowable_error>
                </TendonSlackLength>
                <EmgScalingFactors>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.2</max_allowable_error>
                    <!--Reference value relative to which errors are calculated-->
                    <error_center>0.3</error_center>
                </EmgScalingFactors>
                <NormalizedMuscleFiberLength>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.1</max_allowable_error>
                </NormalizedMuscleFiberLength>
                <PassiveMuscleForces>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>50</max_allowable_error>
                </PassiveMuscleForces>
            </IndividualMuscles>
            <GroupedMuscles>
                <NormalizedMuscleFiberLength>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.05</max_allowable_error>
                </NormalizedMuscleFiberLength>
                <EmgScalingFactors>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.1</max_allowable_error>
                </EmgScalingFactors>
                <ElectromechanicalDelay>
                    <!--Flag indicating whether or not the term is enabled in the cost function.-->
                    <is_enabled>true</is_enabled>
                    <!--Max allowable error or deviation from indicated set point-->
                    <max_allowable_error>0.2</max_allowable_error>
                    <!--Boolean (true, false) indicating if delay values should be found individually for each muscle or all together-->
                    <muscle_specific_electromechanical_delays>false</muscle_specific_electromechanical_delays>
                </ElectromechanicalDelay>
            </GroupedMuscles>
			<SynergyExtrapolationSettings>
            <!--*Optional* space-separated list of prefixes that indicate different speeds or tasks, one speed or task will be assumed for all trials-->
            <task_prefixes>speed1 speed2</task_prefixes>
            <!--Specify the matrix factorization approach for MSA; PCA or NMF.-->
            <matrix_factorization_method>PCA</matrix_factorization_method>
            <!--Indicate the number of synergies for synergy extrapolation.-->
            <number_of_synergies>5</number_of_synergies>
            <!--Indicate categorization of variability for synergy extrapolation: Task, Trial, or Subject.-->
            <synergy_extrapolation_categorization>trial</synergy_extrapolation_categorization>
            <!--Indicate categorization of variability for muscle activation residuals: Task, Trial, or Subject.-->
            <residual_categorization>task</residual_categorization>
            <MeasuredInverseDynamicJointMoments>
                <!--Flag indicating whether or not the term is enabled in the cost function.-->
                <is_enabled>true</is_enabled>
                <!--Max allowable error or deviation from indicated set point-->
                <max_allowable_error>2.5</max_allowable_error>
            </MeasuredInverseDynamicJointMoments>
            <ExtrapolatedMuscleActivations>
                <!--Flag indicating whether or not the term is enabled in the cost function.-->
                <is_enabled>true</is_enabled>
                <!--Max allowable error or deviation from indicated set point-->
                <max_allowable_error>0.3</max_allowable_error>
            </ExtrapolatedMuscleActivations>
            <ResidualMuscleActivations>
                <!--Flag indicating whether or not the term is enabled in the cost function.-->
                <is_enabled>true</is_enabled>
                <!--Max allowable error or deviation from indicated set point-->
                <max_allowable_error>0.3</max_allowable_error>
            </ResidualMuscleActivations>
        </SynergyExtrapolationSettings>
        </MuscleTendonCostFunctionTerms>
        <!--END MTP SPECIFIC SETTINGS-->
    </MuscleTendonPersonalizationTool>
</OpenSimDocument>
